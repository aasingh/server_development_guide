= Themes

{{book.project.name}} provides theme support for web pages and emails. This allows customizing the look and feel of end-user facing pages so they can be
integrated with your applications.

[[img-sunset]]
.Login page with sunrise example theme
image:../../images/login-sunrise.png[]

== Theme Types

A theme can provide one or more types to customize different aspects of {{book.project.name}}. The types available are:

* Account - Account management
* Admin - Admin console
* Email - Emails
* Login - Login forms
* Welcome - Welcome page

== Configure Theme

All theme types, except welcome, is configured through the `Admin Console`. To change the theme used for a realm open the `Admin Console`, select
your realm from the drop-down box in the top left corner. Under `Settings` click on `Theme`.

NOTE: To set the theme for the `master` admin console you need to set the admin console theme for the `master` realm

To change the welcome theme you need to edit `standalone/configuration/keycloak-server.json` and add `welcomeTheme` to the theme element, for example: 

....
"theme": {
    ...
    "welcomeTheme": "custom-theme",
    ...
}
....

== Default Themes

{{book.project.name}} comes bundled with default themes in the server's root `themes` directory. To simplify upgrading you should not edit the bundled themes
directly. Instead create your own theme that extends one of the bundle themes.

== Creating a Theme

A theme consists of: 

* HTML templates (FreeMarker)
* Stylesheets
* Scripts
* Images
* Message bundles
* Theme properties        

Unless you plan to replace every single page you should extend another theme. Most likely you will want to extend {{book.project.name}}, but you may also
consider extending the base theme if you are significantly changing the look and feel of the pages. The base theme primarily consists of HTML templates and
message bundles, while the {{book.project.name}} theme primarily contains images and stylesheets.

When extending a theme you can override individual resources (templates, stylesheets, etc.). If you decide to override HTML templates bear in mind that you may
need to update your custom template when upgrading to a new release.

While creating a theme it's a good idea to disable caching as this makes it possible to edit theme resources directly from the `themes` directory without
restarting {{book.project.name}} To do this edit `../standalone/configuration/keycloak-server.json` for `theme` set `staticMaxAge` to `-1` and both
`cacheTemplates` and `cacheThemes` to `false`:

....
"theme": {
    ...
    "staticMaxAge": -1,
    "cacheTemplates": false,
    "cacheThemes": false,
    ...
}
....

Remember to re-enable caching in production as it will significantly impact performance. 

To create a new theme start by creating a new directory in the `themes` directory. The name of the directory becomes the name of the theme. For example to
create a theme called `example-theme` create the directory `themes/example-theme`.

Inside the theme directory create a directory for each of the types your theme is going to provide. For example to add the login type to the `example-theme`
theme create the directory `themes/example-theme/login`.

For each type create a file `theme.properties` which allows setting some configuration for the theme, for example what theme it overrides and if it should
import any themes. For the above example we want to override the base theme and import common resources from the Keycloak theme.

To do this create the file `themes/example-theme/login/theme.properties` with following contents:

....
parent=base
import=common/keycloak
....

You have now created a theme with support for the login type. To check that it works open the admin console. Select your realm and click on `Themes`.
For `Login Theme` select `example-theme` and click `Save`. Then open the login page for the realm.

You can do this either by login through your application or by opening `http://localhost:8080/realms/<realm name>/account`. 

To see the effect of changing the parent theme, set `parent=keycloak` in `theme.properties` and refresh the login page.
To follow the rest of the documentation set it back to `parent=base` before continuing.

=== Theme Properties

* parent - Parent theme to extend
* import - Import resources from another theme
* styles - Space separated list of styles to include

There are a list of properties that can be used to change the css class used for certain element types. Refer to the theme.properties file in the
{{book.project.name}} theme for these.

You can also add your own custom properties and use them from custom templates.`

=== Stylesheets

A theme can have one or more stylesheets, to add a stylesheet create a file inside `resources/css` inside your theme folder. Then add it to the `styles`
property in `theme.properties`.

For example to add `styles.css` to the `example-theme` create `themes/example-theme/resources/css/styles.css` with the following contents:

....
body {
    background-color: #f00;
}
....

Then edit it in `themes/example-theme/theme.properties` and add:

....
styles=css/styles.css
....




=== Scripts

A theme can have one or more scripts, to add a script create a file inside `resources/js` (for example `resources/js/script.js`) inside your theme folder.
Then registering it in `theme.properties` by adding: 

[source]
----
scripts=js/script.js
----

The `scripts` property supports a space separated list so you can add as many as you want.
For example: 

[source]
----
scripts=js/script.js js/more-script.js
----

=== Images

To make images available to the theme add them to `resources/img`.
They can then be used through stylesheets.
For example: 

[source]
----
body {
    background-image: url('../img/image.jpg');
}
----

Or in templates, for example: 

[source]
----
<img src="${url.resourcesPath}/img/image.jpg">
----

=== Messages

Text in the templates are loaded from message bundles.
A theme that extends another theme will inherit all messages from the parents message bundle, but can override individual messages.
For example to replace `Username` on the login form with `Your Username` create the file `messages/messages.properties` inside your theme folder and add the following content: 

[source]
----
username=Your Username
----

For the admin console, there is a second resource bundle named `admin-messages.properties`.
This resource bundle is converted to JSON and shipped to the console to be processed by angular-translate.
It is found in the same directory as messages.properties and can be overridden in the same way as described above. 

=== HTML Templates

Keycloak uses http://freemarker.org[Freemarker Templates] in order to generate HTML.
These templates are defined in `.ftl` files and can be overriden from the base theme.
Check out the Freemarker website on how to form a template file.
To override the login template for the `example-theme` copy `themes/base/login/login.ftl` to `themes/example-theme/login` and open it in an editor.
After the first line (<#import ...>) add `<h1>HELLO WORLD!</h1>` then refresh the page. 

== Theme Archive

...

== Deploying Themes

Themes can be deployed to Keycloak by copying the theme directory to `themes` or it can be deployed as a module.
For a single server or during development just copying the theme is fine, but in a cluster or domain it's recommended to deploy as a module. 

To deploy a theme as a module you need to create an jar (it's basically just a zip with jar extension) with the theme resources and a file `META/keycloak-themes.json` that describes the themes contained in the archive.
For example `example-theme.jar` with the contents: 

* META-INF/keycloak-themes.json
* theme/example-theme/login/theme.properties
* theme/example-theme/login/login.ftl
* theme/example-theme/login/resources/css/styles.css

The contents of META-INF/keycloak-themes.json in this case would be: 

[source]
----
[
{
    "themes": [{
        "name" : "example-theme",
        "types": [ "login" ]
    }]
}
----            
As you can see a single jar can contain multiple themes and each theme can support one or more types. 

The deploy the jar as a module to Keycloak you can either manually create the module or use `jboss-cli`.
It's simplest to use `jboss-cli` as it creates the required directories and module descriptor for you.

To deploy the above jar `jboss-cli` run: 

[source]
----
[
    KEYCLOAK_HOME/bin/jboss-cli.sh --command="module add --name=org.example.exampletheme --resources=example-theme.jar"
----            
If you're on windows run 

[source]
----
KEYCLOAK_HOME/bin/jboss-cli.bat
----
This command creates `modules/org/example/exampletheme/main` containing `example-theme.jar` and `module.xml`. 
Once you've created the module you need to register it with Keycloak do this by editing `../standalone/configuration/keycloak-server.json` and adding the module to `theme/module/modules`.
For example: 

[source]
----
[
"theme": {
    ...
    "module": {
        "modules": [ "org.example.exampletheme" ]
    }
}
----        

If a theme is deployed to `themes` and as a module the first is used.